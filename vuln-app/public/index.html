<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Dynatrace Security Lab</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-5">
    <h1>Dynatrace Security Lab</h1>
    <p class="lead">Simule tráfego e ataques controlados. Use apenas em ambiente de laboratório.</p>

    <div class="mb-3">
      <button id="btn-users" class="btn btn-primary me-2">Simular usuários</button>
      <button id="btn-attacks" class="btn btn-danger">Simular ataques</button>
    </div>

    <div id="output" class="mt-3 p-3 bg-white border" style="min-height:120px;"></div>

    <h5 class="mt-4">Exercícios sugeridos</h5>
    <ol>
      <li>Executar <strong>Simular usuários</strong> e observar logs em <code>/opt/vuln-app/logs</code>.</li>
      <li>Executar <strong>Simular ataques</strong> e observar detecções no Dynatrace Application Security (após instalar OneAgent e habilitar App Security).</li>
      <li>Usar o endpoint <code>/search?q=</code> para testar injeções e aprender DQL / logs.</li>
    </ol>
  </div>

<script>
const out = (t) => {
  const o = document.getElementById('output');
  const p = document.createElement('pre');
  p.textContent = t;
  o.prepend(p);
};

document.getElementById('btn-users').addEventListener('click', async () => {
  out('Simulando usuários...');
  try {
    const r = await fetch('/simulate-users', { method: 'POST' });
    const j = await r.json();
    out(JSON.stringify(j, null, 2));
  } catch(e){ out('Erro: '+e.message) }
});

document.getElementById('btn-attacks').addEventListener('click', async () => {
  out('Simulando ataque (SQLi) ...');
  try {
    const r = await fetch('/simulate-attack', { method: 'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({payload: "' OR '1'='1" }) });
    const j = await r.json();
    out(JSON.stringify(j, null, 2));
  } catch(e){ out('Erro: '+e.message) }
});
</script>
</body>
</html>
